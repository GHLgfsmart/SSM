<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CheckoutMapper">
	
	<!-- 字段 -->
	<sql id="field">
		CO.ID,
		CO.SOURCECODE,
		CO.TIME,
		CO.OUTPUT_TYPE_ID,
		CO.QUANTITY,
		CO.DAMAGEDQTY,
		CO.DAMAGEDREASON,
		CO.SHORTQTY,
		CO.SHORTREASON,
		CO.INSPECTOR,
		OPT.OPTNAME
	</sql>
	
	<sql id="tableName">
		CHECKOUT
	</sql>
	
	<select id="datalistPage" parameterType="page" resultType="pd">
		SELECT 
			<include refid="field" /> 
		FROM <include refid="tableName" /> CO INNER JOIN OUTPUT_TYPE OPT ON CO.OUTPUT_TYPE_ID = OPT.ID
		<where>
			<if test="pd.keywords!= null and pd.keywords != ''"><!-- 关键词检索 -->
				and 
					(
						CO.SOURCECODE LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
					 	or 
					 	CO.QUANTITY LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
					 	or 
					 	CO.DAMAGEDQTY LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
					 	or 
					 	CO.DAMAGEDREASON LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
					 	or 
					 	CO.SHORTQTY LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
					 	or 
					 	CO.SHORTREASON LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
					 	or 
					 	CO.INSPECTOR LIKE CONCAT(CONCAT('%', #{pd.keywords}),'%')
					)
			</if>
			<if test="pd.lastLoginStart!=null and pd.lastLoginStart!=''"><!-- 登录时间检索 -->
				and CO.TIME &gt;= #{pd.lastLoginStart} 
			</if>
			<if test="pd.lastLoginEnd!=null and pd.lastLoginEnd!=''"><!-- 登录时间检索 -->
				and CO.TIME &lt;= #{pd.lastLoginEnd} 
			</if>
		</where>
			ORDER BY CO.TIME DESC
	</select>
	
	<select id="checkoutById" parameterType="pd" resultType="pd">
		SELECT 
			<include refid="field" /> 
		FROM <include refid="tableName" /> CO INNER JOIN OUTPUT_TYPE OPT ON CO.OUTPUT_TYPE_ID = OPT.ID WHERE CO.ID=#{ID}
	</select>
	
	<!-- 删除用户 -->
	<delete id="checkoutdel" parameterType="pd" flushCache="false">
		DELETE FROM 
			<include refid="tableName"></include>
		WHERE ID = #{ID}
	</delete>
	
	<update id="checkoutUpdate" parameterType="pd">
		UPDATE <include refid="tableName"></include> 
		<set>
			<if test="OUT_PUT_TYPE!=null and OUT_PUT_TYPE!='' ">
				OUT_PUT_TYPE=#{OUT_PUT_TYPE},
			</if>
			<if test="QUANTITY!=null and QUANTITY!='' ">
				QUANTITY=#{QUANTITY},
			</if>
			<if test="DAMAGEDQTY!=null and DAMAGEDQTY!='' ">
				DAMAGEDQTY=#{DAMAGEDQTY},
			</if>
			<if test="DAMAGEDREASON!=null and DAMAGEDREASON!='' ">
				DAMAGEDREASON=#{DAMAGEDREASON},
			</if>
			<if test="SHORTQTY!=null and SHORTQTY!='' ">
				SHORTQTY=#{SHORTQTY},
			</if>
			<if test="SHORTREASON!=null and SHORTREASON!='' ">
				SHORTREASON=#{SHORTREASON},
			</if>
		</set>
		WHERE ID=#{ID}
	</update>
	
	<insert id="checkoutInsert" parameterType="pd">
		INSERT INTO <include refid="tableName"></include> VALUES(
			#{ID},
			#{SOURCECODE},
			#{TIME},
			#{OUTPUT_TYPE_ID},
			#{QUANTITY},
			#{DAMAGEDQTY},
			#{DAMAGEDREASON},
			#{SHORTQTY},
			#{SHORTREASON},
			#{INSPECTOR}
		)
	</insert>
</mapper>